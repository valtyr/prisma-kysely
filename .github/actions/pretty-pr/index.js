const core = require('@actions/core');
const github = require('@actions/github');
const splitEmoji = require('emoji-aware').split;
const onlyEmoji = require('emoji-aware').onlyEmoji;

async function run() {
  try {
    const token = core.getInput('repo-token');
    const { owner, repo } = github.context.repo;

    const prNumber = getPrNumber();

    if (!prNumber) {
      core.setFailed('Could not get pull request number from context');
      return;
    }

    const octokit = github.getOctokit(token);

    const response = await octokit.rest.pulls.get({
      owner,
      repo,
      pull_number: prNumber,
    });

    const prTitle = response.data.title;

    if (hasEmoji(prTitle)) {
      return;
    }

    const newTitle = addEmoji(prTitle);

    await octokit.rest.pulls.update({
      owner,
      repo,
      pull_number: prNumber,
      title: newTitle,
    });
  } catch (error) {
    console.error(error);
    core.setFailed(error.messsage);
  }
}

function getPrNumber() {
  const pullRequest = github.context.payload.pull_request;

  if (!pullRequest) {
    return undefined;
  }

  return pullRequest.number;
}

function hasEmoji(text) {
  const currentEmoji = onlyEmoji(text);
  return currentEmoji.length !== 0;
}

function addEmoji(text) {
  const result = emojiArray[Math.floor(Math.random() * emojiArray.length)];
  if (!result) return text.trim();
  return `${result} ${text.trim()}`;
}

const emojiPool =
  'ğŸªµğŸªµğŸªµğŸ˜¬ğŸ™ŒğŸ˜…ğŸŒ„ğŸ˜âš¡ï¸ğŸ§ ğŸ§ ğŸ§ âœ¨âœ¨âœ¨âœ¨âœ¨ğŸ¦“ğŸ¦“ğŸ¦“ğŸ¤·â€â™‚ï¸ğŸ¤·â€â™‚ï¸ğŸ¤·â€â™‚ï¸ğŸ¤·â€â™‚ï¸ğŸ„ğŸ„ğŸ„ğŸªğŸªğŸªğŸªğŸ‘©â€ğŸ³ğŸ‘ŒğŸ¦·ğŸ¦·ğŸ¦·ğŸš§ğŸš§ğŸš§ğŸš§ğŸ’½ğŸ’½ğŸ’½ğŸ’½ğŸ’½ğŸ“ğŸ“ğŸ“ğŸ“ğŸ½ğŸ˜¼ğŸ¤™ğŸ¤™ğŸ«‚ğŸ˜ğŸ˜ğŸ¤ªğŸ¤¨ğŸ¤¬ğŸ¤¬ğŸ¤¬ğŸ˜¤ğŸ˜ğŸ¥µğŸ¥¶ğŸ˜¶â€ğŸŒ«ï¸ğŸ˜‘ğŸ¤®ğŸ¤ ğŸ¤ ğŸ¤ ğŸ¤ğŸ˜µâ€ğŸ’«ğŸ¥´ğŸ˜ˆğŸ˜ˆğŸ’©ğŸ’©ğŸ’©ğŸ‘»ğŸ¤¡ğŸ¤¡ğŸ¤¡ğŸ¤¡ğŸ¤¡ğŸ‘ºâ˜ ï¸ğŸ’€ğŸ’€ğŸ’€ğŸ¤–ğŸƒğŸ™ŒğŸ¤ŒğŸ¦¾ğŸ–•ğŸ–•ğŸ–•ğŸ¦µğŸ™ğŸ™ğŸ™ğŸ¦»ğŸ¦»ğŸ«€ğŸ—£ğŸ•µï¸â€â™€ï¸ğŸ‘·â€â™‚ï¸ğŸ‘¨â€ğŸ”§ğŸ§›â€â™‚ï¸ğŸ§Ÿâ€â™€ï¸ğŸ‘¼ğŸ‘¼ğŸ‘¼ğŸ‘¼ğŸ•ºğŸ•ºğŸ•ºğŸ•ºğŸ•ºğŸ§‘â€ğŸ¦½ğŸ§‘â€ğŸ¦¼ğŸ§µğŸª¢ğŸª¢ğŸª¢ğŸª¡ğŸª¡ğŸ§¢ğŸ§¢ğŸ§¢ğŸ¥¾ğŸ‘ŸğŸ‘¡ğŸ‘ ğŸ©´ğŸ§£ğŸ¥½ğŸ¥½ğŸ¥½ğŸŒ‚ğŸ‘“ğŸ‘›ğŸ¸ğŸ¸ğŸ¶ğŸ±ğŸ­ğŸ¹ğŸ°ğŸ¦ŠğŸ»ğŸ¼ğŸ»â€â„ï¸ğŸ¨ğŸ¯ğŸ¦ğŸ®ğŸ·ğŸ½ğŸµğŸ™ˆğŸ™‰ğŸ™ŠğŸ’ğŸ”ğŸ”ğŸ”ğŸ”ğŸ§ğŸ¦ğŸ¤ğŸ£ğŸ¥ğŸ¦†ğŸ¦†ğŸ¦†ğŸ¦…ğŸ¦…ğŸ¦…ğŸ¦…ğŸ¦‰ğŸ¦‡ğŸºğŸ—ğŸ´ğŸ¦„ğŸğŸª±ğŸª±ğŸª±ğŸ›ğŸ¦‹ğŸŒğŸğŸœğŸª°ğŸª°ğŸª²ğŸª³ğŸ¦ŸğŸ¦—ğŸ•¸ğŸ¦‚ğŸ¢ğŸğŸ¦ğŸ¦–ğŸ¦–ğŸ¦–ğŸ¦•ğŸ™ğŸ¦‘ğŸ¦‘ğŸ¦‘ğŸ¦‘ğŸ¦ğŸ¦ğŸ¦€ğŸ ğŸŸğŸ¬ğŸ³ğŸ‹ğŸ¦ˆğŸ¦­ğŸŠğŸ…ğŸ†ğŸ¦“ğŸ¦ğŸ¦§ğŸ¦§ğŸ¦§ğŸ¦§ğŸ¦£ğŸ˜ğŸ¦›ğŸ¦ğŸªğŸ«ğŸ¦’ğŸ¦˜ğŸ¦¬ğŸƒğŸ‚ğŸ„ğŸğŸ–ğŸğŸ‘ğŸ¦™ğŸğŸ¦ŒğŸ•ğŸ©ğŸ¦®ğŸ•â€ğŸ¦ºğŸˆğŸˆâ€â¬›ğŸª¶ğŸ“ğŸ¦ƒğŸ¦¤ğŸ¦šğŸ¦šğŸ¦šğŸ¦œğŸ¦œğŸ¦œğŸ¦¢ğŸ¦©ğŸ•ŠğŸ‡ğŸ¦ğŸ¦¨ğŸ¦¡ğŸ¦«ğŸ¦¦ğŸ¦¦ğŸ¦¦ğŸ¦¥ğŸğŸ€ğŸ¿ğŸ¦”ğŸ¦”ğŸ¦”ğŸ²ğŸ‰ğŸŒµğŸŒµğŸŒµğŸ„ğŸŒ³ğŸ€ğŸğŸğŸŒ·ğŸ’ğŸŒ¾ğŸª¨ğŸšğŸŒ¹ğŸ¥€ğŸŒºğŸŒ¸ğŸŒ¼ğŸŒ»ğŸŒğŸŒğŸŒ›ğŸŒšğŸŒ•ğŸŒ–ğŸŒ—ğŸŒ˜ğŸŒ‘ğŸŒ’ğŸŒ“ğŸŒ”ğŸŒ™ğŸŒğŸŒğŸŒğŸªğŸªğŸªğŸªâ˜„ï¸âš¡ï¸âœ¨ğŸ’¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸŒªğŸŒˆğŸŒˆğŸŒˆğŸŒˆğŸŒˆâ˜€ï¸â˜ƒï¸ğŸŒ¬â˜”ï¸â˜‚ï¸ğŸğŸğŸğŸŠğŸ‹ğŸ‹ğŸ‹ğŸŒğŸ‰ğŸ‡ğŸ“ğŸ«ğŸ«ğŸ«ğŸ«ğŸˆğŸ’ğŸ‘ğŸ¥­ğŸğŸ¥¥ğŸ¥ğŸ…ğŸ†ğŸ¥‘ğŸ¥¦ğŸ¥¬ğŸ¥’ğŸŒ¶ğŸ«‘ğŸŒ½ğŸ¥•ğŸ«’ğŸ«’ğŸ§„ğŸ§…ğŸ¥”ğŸ ğŸ¥ğŸ¥¯ğŸ¥¯ğŸ¥¯ğŸğŸ¥–ğŸ¥¨ğŸ§€ğŸ¥šğŸ³ğŸ³ğŸ³ğŸ³ğŸ§ˆğŸ¥ğŸ§‡ğŸ¥“ğŸ¥©ğŸ¥©ğŸ—ğŸ–ğŸ¦´ğŸŒ­ğŸ”ğŸŸğŸ•ğŸ«“ğŸ¥ªğŸ¥™ğŸ§†ğŸŒ®ğŸŒ¯ğŸ«”ğŸ¥—ğŸ¥˜ğŸ¥«ğŸğŸœğŸ²ğŸ›ğŸ£ğŸ±ğŸ¥ŸğŸ¦ªğŸ¤ğŸ¤ğŸ¤ğŸ™ğŸ˜ğŸ¥ğŸ¥ ğŸ¥®ğŸ¢ğŸ¨ğŸ¦ğŸ¥§ğŸ§ğŸ°ğŸ‚ğŸ®ğŸ­ğŸ¬ğŸ«ğŸ¿ğŸ©ğŸªğŸŒ°ğŸ¥œğŸ¯ğŸ¥›ğŸ«–ğŸµğŸ§‹ğŸºğŸºğŸºğŸºğŸºğŸ»ğŸ¥‚ğŸ·ğŸ¥ƒğŸ¸ğŸ¹ğŸ§‰ğŸ¾ğŸ¾ğŸ¾ğŸ¾ğŸ§ŠğŸ¥„ğŸ§‚ğŸ¥¡ğŸ¥¢âš½ï¸ğŸˆğŸ¥ğŸ¾ğŸğŸ‰ğŸ¥ğŸ±ğŸª€ğŸ“ğŸ“ğŸ“ğŸ“ğŸ¸ğŸ¸ğŸ¸ğŸ’ğŸ‘ğŸ¥ğŸğŸªƒâ›³ï¸ğŸ£ğŸ¤¿ğŸ¤¿ğŸ¤¿ğŸ¥ŠğŸ¥‹ğŸ½ğŸ›¹ğŸ›¼ğŸ›·ğŸª‚ğŸ‚â›·ğŸ¿ğŸ¥Œâ›¸â›¹ï¸â€â™‚ï¸ğŸ¤¼ğŸ‹ï¸â€â™‚ï¸ğŸ¤¸â€â™‚ï¸ğŸ¤ºğŸ¤ºğŸ¤ºğŸ¤¾ğŸ‡ğŸ„â€â™‚ï¸ğŸš£ğŸ¥‡ğŸ¥ˆğŸ¥ˆğŸ¥ˆğŸ¥ˆğŸ¥‰ğŸ¥‰ğŸ¥‰ğŸ¥‰ğŸ¥‰ğŸ¥‰ğŸ¥‰ğŸ¥‰ğŸ…ğŸ–ğŸ©°ğŸºğŸºğŸºğŸ·ğŸ¥ğŸª—ğŸª—ğŸª—ğŸ¸ğŸª•ğŸ»ğŸ²ğŸ¯â™ŸğŸ³ğŸ°ğŸš—ğŸš•ğŸš™ğŸšŒğŸğŸš“ğŸš‘ğŸšğŸ›»ğŸššğŸš›ğŸšœğŸ›µğŸš²ğŸš¨ğŸš¨ğŸš¨ğŸš¨ğŸš¨ğŸš¨ğŸš¨ğŸ›ºğŸš ğŸšŸğŸšƒğŸš‹ğŸšğŸšğŸš„ğŸš…ğŸšˆğŸš‚ğŸš‡ğŸšŠğŸš‰âœˆï¸ğŸ›«ğŸ›¬ğŸ›©ğŸ’ºğŸ›°ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸšâ›µï¸ğŸš¤ğŸ›¥ğŸ›³ğŸš¢âš“ï¸ğŸªâ›½ï¸ğŸš¦ğŸ—ºğŸšğŸ—¼ğŸ—½ğŸ—¿ğŸ°ğŸ¯ğŸŸğŸ¡ğŸ¢ğŸ â›²ï¸â›±ğŸ–ğŸğŸœâ›°ğŸ—»ğŸ•â›ºï¸ğŸ›–ğŸ ğŸ¡ğŸšğŸ­ğŸ£ğŸ¤ğŸªğŸ«ğŸ©ğŸ’’ğŸ›â›ªï¸ğŸ•ŒğŸ•ğŸ›•ğŸ•‹â›©ğŸ›¤ğŸ—¾ğŸ‘ğŸŒ…ğŸŒ ğŸ‡ğŸ†ğŸŒ‡ğŸŒ†ğŸŒƒğŸŒŒğŸŒ‰ğŸŒâŒšï¸ğŸ“²ğŸ’»âŒ¨ï¸ğŸ–¥ğŸ–±ğŸ–²ğŸ—œğŸ’½ğŸ’¾ğŸ“¼ğŸ¥â˜ï¸ğŸ“ğŸ“ŸğŸ“ ğŸ“ºğŸ“»â°â³ğŸ”ŒğŸ”ŒğŸ”ŒğŸ”ŒğŸ”ŒğŸ’¡ğŸ’¡ğŸ’¡ğŸ’¡ğŸ”¦ğŸ•¯ğŸª”ğŸ§¯ğŸ§¯ğŸ§¯ğŸ§¯ğŸ›¢ğŸ’¸ğŸ’¸ğŸ’¸ğŸ’µğŸ’´ğŸ’¶ğŸ’·ğŸª™ğŸ’°ğŸ’³ğŸ’ğŸ’ğŸ’ğŸ’âš–ï¸ğŸªœğŸ§°ğŸª›ğŸ”¨ğŸ”§âš’ğŸ› ğŸªšğŸ”©âš™ï¸ğŸª¤ğŸª¤ğŸª¤ğŸª¤ğŸª¤ğŸ§±â›“ğŸ§²ğŸ’£ğŸ§¨ğŸª“ğŸ”ªğŸ—¡âš”ï¸ğŸ›¡ğŸš¬ğŸš¬ğŸš¬ğŸš¬ğŸš¬âš°ï¸âš±ï¸ğŸºğŸ”®ğŸ“¿ğŸ§¿ğŸ’ˆâš—ï¸ğŸ”­ğŸ”¬ğŸ•³ğŸ•³ğŸ•³ğŸ©ºğŸ’ŠğŸ’‰ğŸ©¸ğŸ§¬ğŸ¦ ğŸ¦ ğŸ¦ ğŸ¦ ğŸ§«ğŸ§«ğŸ§«ğŸ§ªğŸ§ªğŸŒ¡ğŸ§¹ğŸª ğŸ§ºğŸš½ğŸš½ğŸš½ğŸš½ğŸš½ğŸš°ğŸš¿ğŸ›ğŸª¥ğŸ›€ğŸ§½ğŸª£ğŸ§´ğŸ§´ğŸ§´ğŸ›ğŸ”‘ğŸ›ğŸ§¸ğŸ§¸ğŸšªğŸ—ğŸ–¼ğŸªŸğŸ›ğŸª†ğŸğŸˆğŸˆğŸˆğŸˆğŸğŸª…ğŸª…ğŸª…ğŸ‰ğŸŠğŸª„ğŸª„ğŸª„ğŸğŸ®ğŸğŸ§§ğŸ“§ğŸ’ŒğŸ“¦ğŸ“­ğŸ“¬ğŸ“ªğŸ“«ğŸ“®ğŸ“¯ğŸ“œğŸ“ƒğŸ“‘ğŸ“ŠğŸ“ˆğŸ“‰ğŸ—’ğŸ—“ğŸ“…ğŸ—‘ğŸ“‡ğŸ—ƒğŸ—³ğŸ“‹ğŸ—ğŸ“°ğŸ““ğŸ“”ğŸ“’ğŸ“•ğŸ“—ğŸ“šğŸ“–ğŸ”–ğŸ§·ğŸ”—ğŸ“ğŸ–‡ğŸ“ğŸ“ğŸ“ŒğŸ“âœ‚ï¸ğŸ–ŠğŸ–‹âœ’ï¸ğŸ–ŒğŸ“âœï¸ğŸ”â¤ï¸ğŸ§¡ğŸ’›ğŸ’šğŸ’œğŸ–¤ğŸ¤â¤ï¸â€ğŸ”¥â¤ï¸â€ğŸ”¥â¤ï¸â€ğŸ”¥â¤ï¸â€ğŸ”¥â¤ï¸â€ğŸ”¥â¤ï¸â€ğŸ©¹â£ï¸ğŸ’•ğŸ’ğŸ’“ğŸ’—ğŸ’–ğŸ’–ğŸ’–ğŸ’˜ğŸ’ğŸ”ğŸ”ğŸ”ğŸ”ğŸš­ğŸš·ğŸš¯ğŸš³ğŸš±ğŸ’¯ğŸ’®â™»ï¸âšœï¸ğŸš¾ğŸš¾ğŸš¾â™¿ï¸ğŸ†’ğŸ†—ğŸ‘â€ğŸ—¨ğŸ”Šâ™¥ï¸ğŸ“¢ğŸ´â€â˜ ï¸ğŸ³ï¸â€ğŸŒˆğŸ³ï¸â€ğŸŒˆğŸ³ï¸â€ğŸŒˆğŸ‡¦ğŸ‡½ğŸ‡¦ğŸ‡½ğŸ‡¦ğŸ‡½ğŸ‡¦ğŸ‡½ğŸ‡¦ğŸ‡½ğŸ‡³ğŸ‡µğŸ‡®ğŸ‡¸ğŸ‡ºğŸ‡¦ğŸ‡¸ğŸ‡ªğŸ•´';
const emojiArray = splitEmoji(emojiPool);

run();
